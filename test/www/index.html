<html>

<head>
<title>Hello World</title>
<script type="text/javascript" src="/javascript/jquery/jquery.js">
</script>
</head>

<body>

<script>

/**
 * Display Endian Encloud Service status.
 * 
 * JSONP support / fake AJAX (bypass same-origin policy)
 */

var statusUrl = "http://localhost:8081/test";
var statusTimer = 3000;
var statusTimeout = 5000;
var defaultState = "unknown (could not connect to Encloud Service)";

function jsonpCallback(data) {
    $("#msgid").html(data.state);
}

function jsonpError(x, t, m) {

    console.log("jsonpError: " + t);

    if (t === "timeout")
        $("#msgid").html(defaultState);
}

function jsonpRequest() {
    $.ajax({
        type: "GET",
        url: statusUrl,
        dataType: "jsonp",
        jsonp: "callback",
        jsonpCallback: "jsonpCallback",
        timeout: statusTimeout,
        error: jsonpError
    });
}

function onReady() {
    setInterval(jsonpRequest, statusTimer);
}

$(document).ready(onReady);

</script>

<div id="msgid">
<script>document.write(defaultState)</script>
</div>

</body>
</html>
